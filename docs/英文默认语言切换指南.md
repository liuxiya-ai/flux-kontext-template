# 🌐 英文默认语言切换指南

## 📋 概述

本文档详细说明如何将项目的默认语言从中文切换为英文，使网站打开时默认显示英文内容。这个改动主要面向未来的海外市场扩展需求。

## 🎯 核心改动目标

- **当前状态**: 访问 `/` 显示中文首页，访问 `/en` 显示英文首页
- **目标状态**: 访问 `/` 显示英文首页，访问 `/zh` 显示中文首页
- **URL结构变化**:
  - 英文页面: `/` `/generate` `/pricing` (无前缀)
  - 中文页面: `/zh` `/zh/generate` `/zh/pricing` (带前缀)

## 🔧 需要修改的文件

### 1. 核心配置文件

#### `src/i18n/routing.ts` (主要修改)
```typescript
import {defineRouting} from 'next-intl/routing';
 
export const routing = defineRouting({
  // 支持的语言列表 - 英文为默认，中文为备选
  locales: ['en', 'zh'], // 🔄 调整顺序：英文在前
 
  // 默认语言改为英文
  defaultLocale: 'en', // 🔄 从 'zh' 改为 'en'
  
  // 路径前缀策略保持不变
  localePrefix: 'as-needed'
});

export type Locale = typeof routing.locales[number];
```

**关键变化说明**:
- `locales` 数组顺序调整，英文在前
- `defaultLocale` 从 `'zh'` 改为 `'en'`
- `localePrefix: 'as-needed'` 保持不变，确保默认语言不显示前缀

### 2. 中间件配置

#### `middleware.ts` (无需修改)
中间件配置通常无需修改，因为它会自动读取 `routing.ts` 中的配置。但需要验证以下内容：

```typescript
import createMiddleware from 'next-intl/middleware';
import { routing } from './src/i18n/routing';

// 确保中间件使用更新后的 routing 配置
const intlMiddleware = createMiddleware(routing);
```

### 3. 静态页面生成

#### 所有 `[locale]` 页面的 `generateStaticParams` 函数
需要确保所有页面都能正确生成英文和中文版本：

```typescript
// src/app/[locale]/page.tsx
// src/app/[locale]/generate/page.tsx  
// src/app/[locale]/pricing/page.tsx
// 等所有页面文件

export function generateStaticParams() {
  return routing.locales.map((locale) => ({locale}));
  // 现在会生成: [{locale: 'en'}, {locale: 'zh'}]
  // 英文页面将作为默认页面 (无前缀)
}
```

### 4. SEO 和元数据配置

#### 各页面的 `generateMetadata` 函数
确保元数据正确处理新的默认语言：

```typescript
// 示例：src/app/[locale]/page.tsx
export async function generateMetadata({
  params: {locale}
}: {
  params: {locale: string}
}): Promise<Metadata> {
  const t = await getTranslations({locale, namespace: 'metadata'});
  
  return {
    title: t('home.title'),
    description: t('home.description'),
    alternates: {
      canonical: locale === 'en' ? '/' : `/${locale}`, // 🔄 英文页面为根路径
      languages: {
        'en': '/', // 🔄 英文页面无前缀
        'zh': '/[object Object]中文页面带前缀
      }
    },
    openGraph: {
      title: t('home.title'),
      description: t('home.description'),
      url: locale === 'en' ? '/' : `/${locale}`,
    }
  };
}
```

### 5. 导航组件更新

#### `src/components/LanguageSwitcherIntl.tsx`
语言切换器需要更新显示逻辑：

```typescript
// 更新语言切换器的显示文本和链接
const languages = [
  { code: 'en', name: 'English', flag: '🇺🇸' }, // 🔄 英文在前
  { code: 'zh', name: '中文', flag: '🇨🇳' }
];

// 确保链接指向正确的路径
const getLanguageUrl = (targetLocale: string, currentPath: string) => {
  if (targetLocale === 'en') {
    // 英文页面移除语言前缀
    return currentPath.replace(/^\/zh/, '') || '/';
  } else {
    // 中文页面添加语言前缀
    return `/zh${currentPath}`;
  }
};
```

### 6. 站点地图配置

#### `src/app/sitemap.ts`
更新站点地图以反映新的URL结构：

```typescript
export default function sitemap(): MetadataRoute.Sitemap {
  const baseUrl = 'https://yoursite.com';
  
  const routes = ['', '/generate', '/pricing']; // 主要路由
  
  return routes.flatMap(route => [
    {
      url: `${baseUrl}${route}`, // 🔄 英文页面无前缀
      lastModified: new Date(),
      changeFrequency: 'daily',
      priority: 1,
      alternates: {
        languages: {
          en: `${baseUrl}${route}`, // 🔄 英文无前缀
          zh: `${baseUrl}/zh${route}`, // 🔄 中文带前缀
        }
      }
    }
  ]);
}
```

## 📊 路径对照表

| 页面类型 | 当前 (中文默认) | 修改后 (英文默认) |
|---------|----------------|------------------|
| 英文首页 | `/en` | `/` |
| 中文首页 | `/` | `/zh` |
| 英文生成页 | `/en/generate` | `/generate` |
| 中文生成页 | `/generate` | `/zh/generate` |
| 英文定价页 | `/en/pricing` | `/pricing` |
| 中文定价页 | `/pricing` | `/zh/pricing` |

## ⚠️ 重要注意事项

### 1. SEO 影响
- **301 重定向**: 需要配置从旧URL到新URL的重定向
- **Google Search Console**: 需要更新站点地图并监控收录情况
- **外部链接**: 需要通知合作伙伴更新链接

### 2. 用户体验
- **浏览器书签**: 用户的中文页面书签会失效
- **分享链接**: 之前分享的中文链接需要重定向
- **语言检测**: 可能需要添加基于浏览器语言的智能重定向

### 3. 缓存清理
- **CDN缓存**: 需要清理 Vercel/Cloudflare 等CDN缓存
- **浏览器缓存**: 用户可能需要清理浏览器缓存

## 🚀 实施步骤

### 第一步：备份当前配置
```bash
# 创建备份
git checkout -b backup-zh-default
git push origin backup-zh-default
```

### 第二步：修改核心配置
1. 修改 `src/i18n/routing.ts`
2. 验证 `middleware.ts` 配置
3. 更新所有页面的 `generateMetadata`

### 第三步：更新组件
1. 修改语言切换器
2. 更新导航链接
3. 检查硬编码的URL引用

### 第四步：配置重定向
在 `next.config.js` 中添加重定向规则：

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  async redirects() {
    return [
      // 重定向旧的中文默认路径到新的中文路径
      {
        source: '/',
        has: [
          {
            type: 'header',
            key: 'accept-language',
            value: '.*zh.*'
          }
        ],
        destination: '/zh',
        permanent: false // 使用临时重定向，便于后续调整
      }
    ];
  }
};
```

### 第五步：测试验证
1. **本地测试**: 验证所有页面和功能
2. **构建测试**: 确保静态生成正常
3. **SEO测试**: 检查元数据和链接
4. **性能测试**: 确保加载速度正常

### 第六步：部署和监控
1. **分阶段部署**: 先部署到测试环境
2. **DNS切换**: 更新域名解析
3. **监控指标**: 关注流量和错误率
4. **用户反馈**: 收集用户使用反馈

## 🔧 回滚方案

如果需要回滚到中文默认：

```typescript
// src/i18n/routing.ts
export const routing = defineRouting({
  locales: ['zh', 'en'], // 恢复中文在前
  defaultLocale: 'zh',   // 恢复中文默认
  localePrefix: 'as-needed'
});
```

## 📊 影响评估

### 正面影响
- ✅ 更好的海外用户体验
- ✅ 符合国际化网站标准
- ✅ 有利于海外市场SEO

### 潜在风险
- ⚠️ 现有中文用户需要适应新URL
- ⚠️ 短期内可能影响中文页面SEO排名
- ⚠️ 需要更新所有外部引用链接

## 💡 最佳实践建议

1. **渐进式迁移**: 可以先在子域名测试
2. **用户通知**: 提前通知用户URL变更
3. **监控指标**: 密切关注用户行为变化
4. **A/B测试**: 可以对不同用户群体测试
5. **文档更新**: 同步更新所有相关文档

---

## 📞 技术支持

如需实施此方案，建议：
1. 在开发环境完整测试
2. 准备详细的回滚计划
3. 与SEO团队协调配合
4. 监控部署后的关键指标

此方案基于现有的 next-intl 架构，确保了标准化和可维护性。
