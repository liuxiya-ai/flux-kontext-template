# 📁 AIRender 项目文件夹结构和网页架构图

## 🏗️ 项目整体文件夹结构

```
📦 AIRender (flux-kontext-template)
├── 📁 .next/                          # Next.js 构建输出目录
├── 📁 .git/                           # Git 版本控制
├── 📁 docs/                           # 📚 项目文档目录
│   ├── 📄 项目配置检查和小白上手指南.md
│   ├── 📄 小白到大师完整学习路径.md
│   ├── 📄 登录支付后端API完全掌握指南.md
│   ├── 📄 Next.js语法和文件逻辑完全掌握指南.md
│   ├── 📄 Next.js实战练习-从零到强者.md
│   ├── 📄 Next.js版本详解和项目对比.md
│   ├── 📄 SEO配置检查和优化指南.md
│   ├── 📄 SEO页面架构和内链布局策略.md
│   ├── 📄 生成页面设计方案.md
│   ├── 📄 Generate页面架构技术总结.md        # 🆕 技术总结文档
│   └── 📄 项目文件夹结构和网页架构图.md (本文档)
├── 📁 public/                         # 🌐 静态资源目录
│   ├── 🖼️ favicon.ico                 # 网站图标
│   ├── 📄 robots.txt                  # 搜索引擎爬虫规则
│   ├── 📄 manifest.json               # PWA 应用清单
│   ├── 🖼️ logo.png                    # 主要Logo
│   ├── 🖼️ og-home.png                 # Open Graph 首页图片
│   ├── 🖼️ og-generate.png             # Open Graph 生成页图片
│   └── 📁 images/                     # 其他图片资源
│       ├── 📁 modules/                # AI模块示例图片
│       └── 📁 examples/               # 功能示例图片
├── 📁 scripts/                        # 🔧 脚本工具目录
│   ├── 📄 check-seo.js                # SEO检查脚本
│   ├── 📄 check-config.js             # 配置检查脚本
│   └── 📄 quick-setup.js              # 快速设置脚本
├── 📁 src/                            # 💻 源代码主目录
│   ├── 📁 app/                        # 🚀 Next.js App Router 目录
│   │   ├── 📄 layout.tsx              # 🏠 根布局组件 (全局配置)
│   │   ├── 📄 page.tsx                # 🏠 首页 (/)
│   │   ├── 📄 globals.css             # 🎨 全局样式
│   │   ├── 📄 sitemap.ts              # 🗺️ 网站地图生成器
│   │   ├── 📁 generate/               # 🎨 AI设计生成页面
│   │   │   ├── 📄 page.tsx            # 🎨 生成页面主入口 (/generate)
│   │   │   └── 📁 architecture/       # 🏗️ 建筑渲染功能 (旧版)
│   │   │       └── 📄 page.tsx        # 建筑渲染页面 (/generate/architecture)
│   │   ├── 📁 pricing/                # 💰 定价页面
│   │   │   └── 📄 page.tsx            # 定价页面 (/pricing)
│   │   ├── 📁 auth/                   # 🔐 用户认证页面
│   │   │   ├── 📁 signin/             # 登录页面
│   │   │   └── 📁 signup/             # 注册页面
│   │   ├── 📁 dashboard/              # 📊 用户仪表板
│   │   ├── 📁 resources/              # 📚 资源页面
│   │   │   └── 📄 page.tsx            # 资源页面 (/resources)
│   │   ├── 📁 privacy/                # 🔒 隐私政策
│   │   │   └── 📄 page.tsx            # 隐私政策页面 (/privacy)
│   │   ├── 📁 terms/                  # 📋 服务条款
│   │   │   └── 📄 page.tsx            # 服务条款页面 (/terms)
│   │   └── 📁 api/                    # 🔌 API 路由目录
│   │       ├── 📁 generate/           # 🎨 AI生成相关API
│   │       │   ├── 📁 night-scene/    # 🌃 夜景生成API
│   │       │   │   └── 📄 route.ts    # 夜景生成路由
│   │       │   └── [其他AI模块API]     # 🔮 未来扩展的AI功能API
│   │       ├── 📁 flux-kontext/       # 📤 图片上传API
│   │       │   └── 📄 route.ts        # 文件上传路由 (PUT)
│   │       ├── 📁 architecture-generate/ # 🏗️ 建筑生成API (旧版)
│   │       │   └── 📄 route.ts        # 建筑生成路由
│   │       └── 📁 auth/               # 🔐 认证相关API
│   │           └── 📄 [...nextauth]/route.ts # NextAuth配置
│   ├── 📁 components/                 # 🧩 React 组件目录
│   │   ├── 📁 design/                 # 🎨 设计生成页面核心组件
│   │   │   ├── 📄 design-page-content.tsx  # 🧠 页面大脑组件 (状态管理)
│   │   │   ├── 📄 left-panel.tsx           # ⬅️ 左侧参数控制面板
│   │   │   ├── 📄 right-panel.tsx          # ➡️ 右侧结果展示面板
│   │   │   └── 📁 sub-components/          # 🔧 可复用子组件
│   │   │       ├── 📄 image-uploader.tsx       # 📤 图片上传组件
│   │   │       ├── 📄 prompt-input.tsx         # 📝 提示词输入组件
│   │   │       ├── 📄 aspect-ratio-selector.tsx # 📐 纵横比选择器
│   │   │       ├── 📄 advanced-settings.tsx    # ⚙️ 高级设置组件
│   │   │       ├── 📄 style-selector.tsx       # 🎨 风格选择器
│   │   │       ├── 📄 room-type-selector.tsx   # 🏠 房间类型选择器
│   │   │       ├── 📄 similarity-selector.tsx  # 🔄 相似度选择器
│   │   │       └── 📄 performance-slider.tsx   # ⚡ 性能滑块
│   │   ├── 📁 ui/                     # 🎨 基础UI组件 (Shadcn UI)
│   │   │   ├── 📄 button.tsx          # 按钮组件
│   │   │   ├── 📄 input.tsx           # 输入框组件
│   │   │   ├── 📄 textarea.tsx        # 文本域组件
│   │   │   ├── 📄 select.tsx          # 下拉选择器
│   │   │   ├── 📄 card.tsx            # 卡片组件
│   │   │   ├── 📄 progress.tsx        # 进度条组件
│   │   │   └── 📄 ...                 # 其他UI组件
│   │   ├── 📄 Navigation.tsx          # 🧭 导航栏组件
│   │   ├── 📄 Footer.tsx              # 🦶 页脚组件
│   │   ├── 📄 HomeContent.tsx         # 🏠 首页内容组件
│   │   ├── 📄 FluxKontextGenerator.tsx # 🎥 旧版AI生成器 (已废弃)
│   │   ├── 📄 ArchitectureGenerator.tsx # 🏗️ 建筑生成器 (旧版)
│   │   ├── 📄 PricingContent.tsx      # 💰 定价页面内容组件
│   │   ├── 📄 KeyFeatures.tsx         # ⭐ 核心功能组件
│   │   ├── 📄 HowToSteps.tsx          # 📝 使用步骤组件
│   │   ├── 📄 FAQ.tsx                 # ❓ 常见问题组件
│   │   └── 📄 StructuredData.tsx      # 🔗 结构化数据组件
│   ├── 📁 lib/                        # 🛠️ 工具库目录
│   │   ├── 📄 utils.ts                # 通用工具函数
│   │   ├── 📄 fal-server.ts           # 🤖 FAL.AI服务端集成
│   │   │                              # (包含NightSceneGenerationService类)
│   │   ├── 📄 auth.ts                 # 🔐 认证逻辑
│   │   ├── 📄 database.ts             # 🗄️ 数据库操作
│   │   ├── 📁 config/                 # ⚙️ 配置文件目录
│   │   │   └── 📄 design-modules.ts   # 🎨 AI模块配置 (核心配置驱动文件)
│   │   ├── 📁 supabase/               # 🗄️ Supabase配置
│   │   └── 📁 types/                  # 📝 类型定义
│   ├── 📁 hooks/                      # 🎣 自定义React Hooks
│   ├── 📁 types/                      # 📝 全局类型定义
│   └── 📁 styles/                     # 🎨 样式文件目录
├── 📄 package.json                    # 📦 项目依赖配置
├── 📄 next.config.js                  # ⚙️ Next.js 配置 (含图片域名配置)
├── 📄 tailwind.config.ts              # 🎨 Tailwind CSS 配置
├── 📄 tsconfig.json                   # 📝 TypeScript 配置
├── 📄 components.json                 # 🧩 Shadcn UI 组件配置
├── 📄 biome.json                      # 🔧 代码格式化配置
├── 📄 eslint.config.mjs               # 📏 代码检查配置
├── 📄 .env.local                      # 🔐 环境变量 (本地)
├── 📄 .env.example                    # 📋 环境变量示例
├── 📄 .gitignore                      # 🚫 Git 忽略文件
├── 📄 README.md                       # 📖 项目说明文档
└── 📄 bun.lock                        # 🔒 Bun 包管理器锁定文件
```

## 🌐 网页结构架构图

### 📱 网站导航结构

```
🏠 AIRender 主站
├── 🏠 首页 (/)
│   ├── 🎯 Hero 区域 (主要CTA)
│   ├── 🎨 AI功能展示区
│   ├── ⭐ 核心功能介绍
│   ├── 📝 使用步骤说明
│   ├── ❓ 常见问题
│   └── 🦶 页脚信息
├── 🎨 AI设计生成页 (/generate) ⭐ **核心功能页面**
│   ├── 🧠 DesignPageContent (状态管理大脑)
│   ├── ⬅️ LeftPanel (参数控制区)
│   │   ├── 🎨 模块选择器 (配置驱动)
│   │   │   ├── 🌟 Inspire (灵感生成)
│   │   │   ├── 🏗️ Exterior (外观设计)
│   │   │   ├── 🏠 Interior (室内设计)
│   │   │   ├── 🔄 Modify (图片修改)
│   │   │   └── 🌃 Night Scene (夜景渲染) ✅ **已实现**
│   │   ├── 📤 图片上传区
│   │   ├── 📝 参数控制区 (动态渲染)
│   │   │   ├── 📝 提示词输入 (可隐藏)
│   │   │   ├── 📐 纵横比选择
│   │   │   ├── �� 种子值设置
│   │   │   ├── 🔢 图片数量
│   │   │   └── ❌ 隐藏提示词输入 (hidePromptInput: true)
│   │   └── 🚀 生成按钮 (状态感知)
│   └── ➡️ RightPanel (结果展示区)
│       ├── 📖 模块说明
│       ├── 🖼️ 示例图片
│       ├── 🔄 生成进度
│       ├── ❌ 错误提示
│       └── ✅ 结果展示
├── 🏗️ 建筑渲染页 (/generate/architecture) - 旧版
├── 💰 定价页面 (/pricing)
│   ├── 📊 订阅计划
│   ├── 💳 积分包
│   └── ❓ 定价FAQ
├── 🔐 用户认证 (/auth/signin, /auth/signup)
├── 📊 用户仪表板 (/dashboard)
├── 📚 资源页面 (/resources)
├── 🔒 隐私政策 (/privacy)
└── 📋 服务条款 (/terms)
```

### 🧩 核心Generate页面组件层级结构

```
📱 Generate Page Layout (/generate/page.tsx) - 服务器组件
├── 🧠 DesignPageContent (客户端大脑组件)
│   ├── 📊 状态管理 (useState + updateState)
│   │   ├── selectedModule: string (当前选中模块)
│   │   ├── inputImage: File | null (用户上传图片)
│   │   ├── uploadedImageUrl: string | null (上传后URL)
│   │   ├── prompt: string (用户提示词)
│   │   ├── aspectRatio: string (纵横比)
│   │   ├── seed: number | null (种子值)
│   │   ├── numberOfImages: number (生成数量)
│   │   ├── isGenerating: boolean (生成中状态)
│   │   ├── isUploading: boolean (上传中状态)
│   │   ├── generatedImages: string[] (生成结果)
│   │   ├── generationError: string | null (错误信息)
│   │   └── processingTime: number | null (处理时间)
│   ├── ⬅️ LeftPanel (参数控制面板)
│   │   ├── 🎨 ModuleSelector (模块选择器)
│   │   │   └── 📋 design-modules.ts 配置驱动渲染
│   │   ├── 📤 ImageUploader (图片上传组件)
│   │   │   ├── 📁 文件拖拽上传
│   │   │   ├── 🖼️ 图片预览
│   │   │   └── ❌ 移除功能
│   │   ├── 📝 动态参数控件 (根据模块配置渲染)
│   │   │   ├── 📝 PromptInput (提示词输入) - 可配置隐藏
│   │   │   ├── 📐 AspectRatioSelector (纵横比选择)
│   │   │   ├── ⚙️ AdvancedSettings (高级设置)
│   │   │   │   ├── 🔢 种子值输入
│   │   │   │   └── 🔢 图片数量选择
│   │   │   ├── 🎨 StyleSelector (风格选择器)
│   │   │   ├── 🏠 RoomTypeSelector (房间类型)
│   │   │   ├── 🔄 SimilaritySelector (相似度)
│   │   │   └── ⚡ PerformanceSlider (性能滑块)
│   │   └── 🚀 GenerateButton (生成按钮)
│   │       ├── 💤 默认状态: "Generate"
│   │       ├── 🔄 生成中: "Generating..." + Loader
│   │       └── ❌ 错误状态: 错误提示
│   └── ➡️ RightPanel (结果展示面板)
│       ├── 📖 模块信息展示
│       │   ├── 📝 标题和描述
│       │   └── 🖼️ 示例图片
│       ├── 🔄 生成状态展示
│       │   ├── 🔄 加载中: "Generating image..." + 取消按钮
│       │   ├── ❌ 错误状态: 错误信息 + 重试按钮
│       │   └── ✅ 成功状态: 结果图片 + 下载功能
│       └── 📊 处理时间显示
└── 🔗 SEO & Meta (服务器组件)
    ├── 📄 Metadata 配置
    └── 🕷️ 结构化数据
```

## 🎯 夜景功能技术架构流程图

### 🌃 夜景生成完整流程

```
👤 用户操作流程
    ↓
🎨 选择 "Night Scene" 模块
    ↓ (触发 handleModuleSelect)
📋 design-modules.ts 配置加载
    ↓ (根据配置动态渲染UI)
⬅️ LeftPanel 渲染专用控件
    ├── 📤 图片上传 (必需)
    ├── 📐 纵横比 (9种选项 + Default)
    ├── 🔢 种子值 (可选)
    ├── 🔢 图片数量 (1-4)
    └── ❌ 隐藏提示词输入 (hidePromptInput: true)
    ↓
🚀 点击 "Generate" 按钮
    ↓ (触发 handleGenerate)
📤 步骤1: 图片上传到 fal.ai
    ↓ (调用 /api/flux-kontext PUT)
🔗 获取图片URL
    ↓
🎨 步骤2: 调用夜景生成API
    ↓ (调用 /api/generate/night-scene POST)
🔐 用户认证检查
    ↓
🤖 NightSceneGenerationService.generate()
    ├── 📝 固定专业提示词
    ├── 🖼️ 用户上传图片URL
    ├── ⚙️ guidance_scale: 3.5
    ├── 📐 用户选择纵横比 (可选)
    ├── 🔢 用户设置种子 (可选)
    └── 🔢 用户选择数量 (默认1)
    ↓
🌐 fal.ai API 调用
    ↓ (约8-10秒处理)
✅ 返回夜景图片结果
    ↓
➡️ RightPanel 展示结果
    ├── 🖼️ 生成的夜景图片
    ├── ⏱️ 处理时间显示
    └── 💾 下载功能
```

### 🔌 API架构流程

```
🌐 前端请求 → 🔌 Next.js API Router → 🤖 fal.ai 服务

POST /api/generate/night-scene
    ↓
📋 请求体验证
    ├── ✅ image_url (必需)
    ├── 📐 aspect_ratio (可选)
    ├── 🔢 seed (可选)
    └── 🔢 num_images (可选)
    ↓
🔐 用户认证检查 (NextAuth)
    ↓
🤖 NightSceneGenerationService
    ├── 📝 prompt: 固定专业夜景提示词
    ├── 🖼️ image_url: 用户上传图片
    ├── ⚙️ guidance_scale: 3.5 (固定)
    ├── 📄 output_format: "jpeg" (固定)
    └── [可选参数根据用户输入添加]
    ↓
🌐 fal.subscribe("fal-ai/flux-pro/kontext")
    ├── 📊 实时状态更新
    ├── 🔄 队列处理
    └── ✅ 返回结果
    ↓
📤 响应格式化
    ├── ✅ success: true
    ├── 🖼️ images: Array<{url}>
    └── ⏱️ processingTime: number
```

## 🔗 配置驱动架构核心

### 📋 design-modules.ts 配置驱动系统

```typescript
// 🎨 AI模块配置 - 系统核心
export interface DesignModule {
  id: string                    // 模块标识
  name: string                  // 显示名称
  image: string                 // 模块图标
  controls: ModuleControl       // UI控件配置
  title: string                 // 模块标题
  description: string           // 模块描述
  examples: ExampleImage[]      // 示例图片
}

export interface ModuleControl {
  requiresInputImage?: boolean     // 是否需要输入图片
  hidePromptInput?: boolean        // 🆕 是否隐藏提示词输入
  aspectRatios?: SelectOption[]    // 🆕 纵横比选项
  requiresSeedInput?: boolean      // 🆕 是否需要种子输入
  requiresImageCount?: boolean     // 🆕 是否需要图片数量
  // ... 其他控件配置
}

// 🌃 夜景模块配置示例
{
  id: 'night-scene',
  name: 'Night Scene',
  controls: {
    requiresInputImage: true,        // ✅ 需要图片上传
    hidePromptInput: true,           // ✅ 隐藏提示词
    aspectRatios: [                  // ✅ 9种纵横比选项
      { value: 'default', label: 'Default' },
      { value: '21:9', label: '21:9' },
      // ... 8种其他比例
    ],
    requiresSeedInput: true,         // ✅ 显示种子输入
    requiresImageCount: true,        // ✅ 显示数量选择
  },
  // ...
}
```

### 🔄 动态UI渲染逻辑

```typescript
// ⬅️ left-panel.tsx 中的配置驱动渲染
export function LeftPanel({ selectedModule, state, setState, onGenerate }) {
  return (
    <div className="space-y-6">
      {/* 📤 图片上传 - 根据配置显示 */}
      {selectedModule.controls.requiresInputImage && (
        <ImageUploader 
          value={state.inputImage}
          onChange={file => setState({ inputImage: file })}
        />
      )}

      {/* 📝 提示词输入 - 根据配置隐藏 */}
      {!selectedModule.controls.hidePromptInput && (
        <PromptInput 
          prompt={state.prompt}
          onPromptChange={value => setState({ prompt: value })}
        />
      )}

      {/* 📐 纵横比选择 - 根据配置显示选项 */}
      {selectedModule.controls.aspectRatios && (
        <Select
          value={state.aspectRatio}
          onValueChange={value => setState({ aspectRatio: value })}
        >
          {selectedModule.controls.aspectRatios.map(option => (
            <SelectItem key={option.value} value={option.value}>
              {option.label}
            </SelectItem>
          ))}
        </Select>
      )}

      {/* ⚙️ 高级设置 - 根据配置显示 */}
      {(selectedModule.controls.requiresSeedInput || 
        selectedModule.controls.requiresImageCount) && (
        <AdvancedSettings
          seed={state.seed}
          numberOfImages={state.numberOfImages}
          onSeedChange={value => setState({ seed: value })}
          onNumberChange={value => setState({ numberOfImages: value })}
          showSeed={selectedModule.controls.requiresSeedInput}
          showImageCount={selectedModule.controls.requiresImageCount}
        />
      )}

      {/* 🚀 生成按钮 */}
      <Button onClick={onGenerate} disabled={state.isGenerating}>
        {state.isGenerating ? (
          <>
            <Loader2 className="mr-2 h-4 w-4 animate-spin" />
            Generating...
          </>
        ) : (
          'Generate'
        )}
      </Button>
    </div>
  )
}
```

## 📊 性能优化架构

### ⚡ 图片加载优化策略

```
🖼️ Next.js Image 优化
├── 🌐 外部域名配置 (next.config.js)
│   ├── v3.fal.media (fal.ai 上传域名)
│   ├── fal.media (fal.ai 生成域名)  
│   └── storage.googleapis.com (模拟数据)
├── 📏 响应式图片
├── 🔄 懒加载
└── 🎯 关键图片预加载

🚀 组件加载优化
├── 🌳 代码分割 (dynamic import)
├── 📦 组件懒加载
├── 🔄 状态优化
└── 🗜️ Bundle优化
```

### 🔍 错误处理和用户体验

```
🛡️ 错误处理架构
├── 📤 上传错误处理
│   ├── 🚫 文件格式检查
│   ├── 📏 文件大小限制
│   └── 🌐 网络超时处理
├── 🤖 API错误处理
│   ├── 🔐 认证错误
│   ├── ⏱️ 超时错误 (120秒)
│   ├── 🌐 网络错误
│   └── 🤖 AI服务错误
├── 🎨 UI状态管理
│   ├── 🔄 加载状态
│   ├── ❌ 错误状态
│   ├── ✅ 成功状态
│   └── 🔄 重试机制
└── 🕵️ 调试模式
    ├── 🧪 模拟模式 (MOCK_API_CALLS)
    ├── 📊 详细日志
    └── 🔍 错误追踪
```

---

## 💡 使用说明

### 🔍 如何使用这个架构图

1. **📁 文件定位**: 使用文件夹结构图快速找到需要修改的文件
2. **🎨 功能理解**: 通过配置驱动架构了解如何添加新的AI模块
3. **🔗 API集成**: 参考夜景功能的API架构集成新的AI服务
4. **📱 组件开发**: 根据组件层级结构开发可复用组件
5. **🚀 性能优化**: 使用性能优化架构提升应用性能

### 🛠️ 开发工作流程

1. **📋 需求分析** → 确定要添加的AI功能模块
2. **📋 配置更新** → 在 `design-modules.ts` 中添加模块配置
3. **🤖 服务开发** → 在 `fal-server.ts` 中添加AI服务类
4. **🔌 API路由** → 创建对应的 `/api/generate/[module]` 路由
5. **🎨 UI自动渲染** → 配置驱动系统自动渲染UI
6. **🧪 测试调试** → 使用模拟模式测试功能
7. **📱 响应式测试** → 确保各设备显示正常
8. **⚡ 性能测试** → 运行性能检查脚本

### 📊 扩展新AI模块步骤

1. **📋 添加配置** → `src/lib/config/design-modules.ts`
2. **🤖 创建服务** → `src/lib/fal-server.ts` 添加新的 Service 类
3. **🔌 创建API** → `src/app/api/generate/[new-module]/route.ts`
4. **🖼️ 添加资源** → `public/images/modules/` 和 `public/images/examples/`
5. **📝 更新文档** → 同步更新相关技术文档

### 📊 维护和更新

- **🔍 定期配置检查**: 验证 `design-modules.ts` 配置完整性
- **📊 性能监控**: 使用 Lighthouse 检查页面性能
- **🔄 依赖更新**: 定期更新 fal.ai SDK 和相关依赖
- **📝 文档更新**: 新功能实现后及时更新架构图和技术文档

---

**💡 提示**: 这个架构图反映了AIRender项目的实际实现，特别是配置驱动的可扩展架构。夜景功能是一个完整的实现示例，为后续模块扩展提供了标准模板！ 